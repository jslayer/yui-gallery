YUI.add("a2",function(e,t){function a(e){this.host=e.host,a.superclass.constructor.apply(this,arguments)}function f(e){this.host=e.host,f.superclass.constructor.apply(this,arguments)}function l(e){this.host=e.host,l.superclass.constructor.apply(this,arguments)}function c(e){this.host=e.host,c.superclass.constructor.apply(this,arguments)}function h(e){this.host=e.host,h.superclass.constructor.apply(this,arguments)}function p(e){this.host=e.host,p.superclass.constructor.apply(this,arguments)}var n=e.Array,r=e.Object,i=e.Lang,s="",o=/^\s*$/,u;u=function d(){d.superclass.constructor.apply(this,arguments)},u.NAME="A2",e.extend(u,e.Base,{initializer:function(){this.publish("pre",{emitFacade:!0}),this.publish("main",{emitFacade:!0}),this.plug(p),this.plug(a),this.plug(f),this.plug(l),this.plug(c),this.plug(h);var e=this.get("srcNode").getDOMNode();this.onceAfter("initializedChange",function(){console.time("tree"),this.processTree(this.parse(e)),console.timeEnd("tree")}),e.style.visibility="visible"},parse:function(e,t){var r={},i={node:e,parent:t||!1},s;return s=this.fire("pre",{element:i}),s&&e.childNodes&&e.childNodes.length>0&&(i.children=[],n.each(e.childNodes,function(e){var t=!1,n;switch(e.nodeType){case 1:t=!0;break;case 3:o.test(e.textContent)||(t=!0)}t&&i.children.push(this.parse(e,i))},this)),i},processTree:function(e,t){this.fire("main",{element:e,data:t}),e.children&&n.each(e.children,function(e){this.processTree(e,t)},this)},processString:function(e,t,n){var r,i,o,a;o=u.TYPES.GLOBAL,a=e.match(u.EXPR.PARSE),i=a[2];switch(a[1]){case"&.":o=u.TYPES.LOCAL,t.data&&t.data[i]&&(r=t.data[i]);break;default:r=this.get(i)}return{value:r||s,type:o,name:i}}},{NAME:"A2",ATTRS:{srcNode:{setter:function(t){return i.type(t)?e.one(t):t}}},EXPR:{SPLIT:/({{\s*[&.a-zA-Z0-9]+\s*}})/g,PARSE:/(&.)?(\w+)/,TEST:/^{{\s*[&.a-zA-Z0-9]+\s*}}$/g},TYPES:{GLOBAL:"global",LOCAL:"local"}}),e.extend(a,e.Plugin.Base,{initializer:function(){this.onHostEvent("main",function(e){e.element.node.nodeType===3&&this.main(e.element,e)})},main:function(e,t){var r=i.trim(e.node.wholeText),o=document.createDocumentFragment();n.each(r.split(u.EXPR.SPLIT),function(n){var r;if(n){if((new RegExp(u.EXPR.TEST)).test(n)){var i=this.host.processString(n,t,e);i.type===u.TYPES.GLOBAL&&this.afterHostEvent(i.name+"Change",function(e){r.nodeValue=e.newVal||s}),r=document.createTextNode(i.value)}else r=document.createTextNode(n);r&&o.appendChild(r)}},this),e.node.parentNode.replaceChild(o,e.node)}},{NS:"PluginTextModel"}),e.extend(f,e.Plugin.Base,{initializer:function(){this.onHostEvent("main",function(e){e.element.node.nodeType===1&&this.main(e.element,e)})},main:function(t,n){var r=t.node,s=r.getAttribute("data-model");if(s){t.data||(t.data={}),t.data.nodeModel=s;switch(r.nodeName){case"INPUT":switch(r.type){case"text":r.value=this.host.get(s),(new e.Node(r)).after(["keyup","change"],function(e){r.value!==this.host.get(s)&&this.host.set(s,r.value)},this),this.host.after(s+"Change",function(e){e.newVal!==r.value&&(r.value=e.newVal)});break;case"checkbox":var o=this.host.get(s);i.isUndefined(o)?this.host.set(s,r.checked&&r.value):r.checked=!!o,(new e.Node(r)).after("change",function(e){r.checked!==!!this.host.get(s)&&this.host.set(s,r.checked&&r.value)},this),this.afterHostEvent(s+"Change",function(e){!!e.newVal!==r.checked&&(r.checked=!!e.newVal)})}}}}},{NS:"PluginNodeModel"}),e.extend(l,e.Plugin.Base,{initializer:function(){this.onHostEvent("pre",function(e){e.element.node.nodeType===1&&e.element.node.getAttribute("data-repeat")&&(this.pre(e.element,e),e.halt(!0))})},pre:function(e,t){var n=e.node.getAttribute("data-repeat"),r=n.match(l.EXPR.PARSE);r.length===6&&(e.data||(e.data={}),e.data.NodeRepeat={modelName:r[5],localName:r[4],indexName:r[3]||!1,template:i.trim(e.node.innerHTML)},this.process(e),this.afterHostEvent(r[5]+"Change",function(t){this.process(e)},this))},process:function(e){var t,i,o;t=e.data.NodeRepeat,i=document.createDocumentFragment(),o=document.createElement("div"),r.each(this.host.get(t.modelName),function(r,s){var u,a;u={},o.innerHTML=t.template,t.indexName&&(u[t.indexName]=s),u[t.localName]=r,a=this.host.parse(o),a.parent=e,this.host.processTree(a,u),n.each(o.childNodes,function(e){i.appendChild(e)})},this),e.node.innerHTML=s,e.node.appendChild(i)}},{NS:"PluginNodeRepeat",EXPR:{PARSE:/(((\w+)\s*\:\s*)?(\w+))\s*in\s*(\w+)/}}),e.extend(c,e.Plugin.Base,{initializer:function(){this.onHostEvent("main",function(e){var t=e.element.node;t.nodeType===1&&(t.getAttribute("data-show")||t.getAttribute("data-hide"))&&this.main(e.element,e)})},main:function(e,t){var n=e.node,r=-1,i=s,o=n.getAttribute("data-show"),u=n.getAttribute("data-hide");o?(r=1,i=o):u&&(r=0,i=u),~r&&(e.data||(e.data={}),this.process(n,!!r,!!this.host.get(i)),this.afterHostEvent(i+"Change",function(e){this.process(n,!!r,!!e.newVal)},this))},process:function(e,t,n){e.style.display=t===n?"block":"none"}},{NS:"PluginNodeShow"}),e.extend(h,e.Plugin.Base,{initializer:function(){this.onHostEvent("main",function(e){var t=e.element.node;t.nodeType===1&&this.main(e.element,e)})},main:function(e,t){n.each(h.LIST,function(r){var i,o;i=e.node.getAttribute(r),i&&(o=[],n.each(i.split(u.EXPR.SPLIT),function(n){o.push((new RegExp(u.EXPR.TEST)).test(n)?this.host.processString(n,t,e).value:n)},this),o=o.join(s),o!==i&&e.node.setAttribute(r,o))},this)}},{NS:"PluginNodeAttributes",LIST:["href","class"]}),e.extend(p,e.Plugin.Base,{initializer:function(){this.onHostEvent("main",function(e){var t=e.element.node;t.nodeType===1&&this.main(e.element,e)})},main:function(t,n){var r=t.node.getAttribute("data-click");r&&(new e.Node(t.node)).on("click",function(e){i.isFunction(this.host[r])&&this.host[r].call(this.host,e)},this)}},{NS:"PluginNodeClick"}),e.A2=u},"@VERSION@",{requires:["widget"],skinnable:!0});
